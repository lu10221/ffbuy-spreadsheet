<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DZ3110PTYG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-DZ3110PTYG');

        // 🔽 自动获取并上报 utm_content 参数
        const urlParams = new URLSearchParams(window.location.search);
        const utmContent = urlParams.get('utm_content');
        if (utmContent) {
            gtag('event', 'utm_content_event', {
                utm_content: utmContent
            });
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Name - $FFBuy SpreadSheet</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="global-search.css">    
    <link rel="stylesheet" href="product-detail-modal.css">
    
    <!-- 🔥 核心配置文件 - 必须最先加载 -->
    <script src="config.js"></script>
    
    <!-- 🔥 导航生成器 - 基于配置自动生成导航 -->
    <script src="navigation-generator.js"></script>
    
    <!-- 其他功能模块 -->
    <script src="product-service.js"></script>
    <script src="product-renderer.js"></script>
    <script src="trust-info.js"></script>
    <script src="product-trust-info.js"></script>
    <script src="product-detail.js"></script>
</head>
<body>
    <!-- 🔥 信任信息栏 - 将由navigation-generator.js自动生成和更新 -->
    <div class="top-info-bar"> 
        <i class="fas fa-shield-alt"></i> 
        Loading...
    </div>
    
    <!-- 🔥 固定Logo栏 - 将由navigation-generator.js自动更新 -->
    <div class="fixed-logo-bar">
        <a href="index.html" class="logo">$FFBuy SpreadSheet</a>
    </div>
    
    <header>
        <div class="header-top">
            <a href="index.html" class="logo">$FFBuy SpreadSheet</a>
            <div class="nav-links">
                <!-- 🔥 导航链接 - 将由navigation-generator.js自动生成 -->
                <a href="#">Loading...</a>
            </div>
        </div>
        <div class="header-bottom">
            <div class="search-container">
                <input type="text" class="search-box" placeholder="Search products...">
                <span class="search-icon"><i class="fas fa-search"></i></span>
            </div>
        </div>
    </header>

    <!-- 🔥 支付方式信息 - 将由navigation-generator.js自动生成 -->
    <div style="text-align: center; margin: 12px 0 18px;">
        <div style="font-size: 13px; color: #555; margin-bottom: 6px;">Loading...</div>
        <div style="display: inline-flex; align-items: center; gap: 12px;">
            Loading...
        </div>
    </div>

    <nav>
        <!-- 🔥 主导航 - 将由navigation-generator.js自动生成 -->
        <a href="#">Loading...</a>
    </nav>

    <main>
        <div id="products-container" class="products-grid">
            <!-- 产品将在这里动态加载 -->
        </div>
    </main>

    <!-- 浮动按钮 -->
    <div id="floating-buttons-container"></div>
    
    <!-- 产品详情模态框 -->
    <div id="product-detail-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-product-content"></div>
        </div>
    </div>

    <script>
        // 🔥 页面特定的产品加载逻辑
        async function fetchProducts() {
            try {
                // 检查必要的依赖
                if (typeof productRenderer === 'undefined') {
                    console.error('productRenderer not loaded');
                    return;
                }
                
                // 🔥 使用导航生成器获取当前分类
                const currentCategory = navigationGenerator.getCurrentCategory();
                if (!currentCategory) {
                    console.error('Could not determine current category');
                    return;
                }
                
                // 🔥 加载当前分类的产品数据
                await productRenderer.loadProducts(currentCategory);
                
            } catch (error) {
                console.error('Error in fetchProducts:', error);
                const productsContainer = document.getElementById('products-container');
                if (productsContainer) {
                    productsContainer.innerHTML = `<div class="error-message">${error.message}</div>`;
                }
            }
        }

        // 当页面加载完成时，调用fetchProducts函数获取产品数据
        document.addEventListener('DOMContentLoaded', function() {
            // 等待导航生成器初始化完成后再加载产品
            setTimeout(fetchProducts, 100);
        });
    </script>
    
    <!-- 其他功能脚本 -->
    <script src="category-navigation.js"></script>
    <script src="global-search.js"></script>
</body>
</html>