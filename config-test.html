<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONFIG系统测试 - $FFBuy SpreadSheet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .test-result {
            background: #f8f9fa;
            padding: 10px;
            border-left: 4px solid #28a745;
            margin: 10px 0;
            font-family: monospace;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .api-url {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
        }
        .category-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .category-item {
            background: #f0f8ff;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #cce7ff;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>CONFIG系统全面测试</h1>
    <p>这个页面展示了如何通过修改 <code>config.js</code> 来控制整个网站的API调用和分类配置。</p>

    <div class="test-section">
        <h2 class="test-title">1. CONFIG对象加载测试</h2>
        <div id="config-test"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">2. API URL生成测试</h2>
        <div id="api-test"></div>
        <button class="button" onclick="testApiUrls()">测试API URL生成</button>
    </div>

    <div class="test-section">
        <h2 class="test-title">3. 分类配置测试</h2>
        <div id="category-test"></div>
        <button class="button" onclick="testCategories()">测试分类配置</button>
    </div>

    <div class="test-section">
        <h2 class="test-title">4. 实际API调用测试</h2>
        <div id="api-call-test"></div>
        <button class="button" onclick="testApiCall()">测试API调用</button>
    </div>

    <div class="test-section">
        <h2 class="test-title">5. 配置修改演示</h2>
        <p>要修改API地址或分类，只需要编辑 <code>config.js</code> 文件：</p>
        <div class="test-result">
            <strong>修改API地址：</strong><br>
            CONFIG.API.BASE_URL = 'https://new-api-url.com/spreadsheet-id'
        </div>
        <div class="test-result">
            <strong>添加新分类：</strong><br>
            CONFIG.categories.push({<br>
            &nbsp;&nbsp;name: 'NewCategory',<br>
            &nbsp;&nbsp;endpoint: 'NewCategory',<br>
            &nbsp;&nbsp;icon: 'fas fa-star',<br>
            &nbsp;&nbsp;fileName: 'NewCategory.html',<br>
            &nbsp;&nbsp;displayName: 'New Category'<br>
            })
        </div>
    </div>

    <script src="config.js"></script>
    <script src="product-service.js"></script>
    <script>
        // 测试CONFIG对象加载
        function testConfigLoading() {
            const configDiv = document.getElementById('config-test');
            
            if (typeof CONFIG === 'undefined') {
                configDiv.innerHTML = '<div class="test-result error">❌ CONFIG对象未加载</div>';
                return;
            }
            
            let html = '<div class="test-result">✅ CONFIG对象已成功加载</div>';
            html += `<div class="test-result">站点名称: ${CONFIG.SITE.NAME}</div>`;
            html += `<div class="test-result">API基础URL: <div class="api-url">${CONFIG.API.BASE_URL}</div></div>`;
            html += `<div class="test-result">默认分类: ${CONFIG.SITE.DEFAULT_CATEGORY}</div>`;
            html += `<div class="test-result">分类总数: ${CONFIG.categories.length}</div>`;
            
            configDiv.innerHTML = html;
        }
        
        // 测试API URL生成
        function testApiUrls() {
            const apiDiv = document.getElementById('api-test');
            
            if (!CONFIG.UTILS || !CONFIG.UTILS.getCategoryUrl) {
                apiDiv.innerHTML = '<div class="test-result error">❌ CONFIG.UTILS.getCategoryUrl 不可用</div>';
                return;
            }
            
            let html = '<div class="test-result">✅ API URL生成功能正常</div>';
            
            // 测试几个分类的URL生成
            const testEndpoints = ['HOTPRODUCTS', 'T-Shirt', 'Hoodie Sweatshirt', 'Shoes'];
            
            testEndpoints.forEach(endpoint => {
                const url = CONFIG.UTILS.getCategoryUrl(endpoint);
                html += `<div class="test-result">${endpoint}: <div class="api-url">${url}</div></div>`;
            });
            
            apiDiv.innerHTML = html;
        }
        
        // 测试分类配置
        function testCategories() {
            const categoryDiv = document.getElementById('category-test');
            
            if (!CONFIG.categories || CONFIG.categories.length === 0) {
                categoryDiv.innerHTML = '<div class="test-result error">❌ 分类配置不可用</div>';
                return;
            }
            
            let html = '<div class="test-result">✅ 分类配置正常</div>';
            html += '<div class="category-list">';
            
            CONFIG.categories.forEach(category => {
                html += `
                    <div class="category-item">
                        <strong>${category.displayName}</strong><br>
                        文件: ${category.fileName}<br>
                        端点: ${category.endpoint}<br>
                        图标: <i class="${category.icon}"></i>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // 测试工具函数
            const testCategory = CONFIG.UTILS.getCategoryByName('Shoes');
            if (testCategory) {
                html += `<div class="test-result">✅ getCategoryByName('Shoes'): ${testCategory.displayName}</div>`;
            }
            
            const testByFile = CONFIG.UTILS.getCategoryByFileName('T-Shirt.html');
            if (testByFile) {
                html += `<div class="test-result">✅ getCategoryByFileName('T-Shirt.html'): ${testByFile.displayName}</div>`;
            }
            
            categoryDiv.innerHTML = html;
        }
        
        // 测试实际API调用
        async function testApiCall() {
            const apiCallDiv = document.getElementById('api-call-test');
            apiCallDiv.innerHTML = '<div class="test-result">🔄 正在测试API调用...</div>';
            
            try {
                if (!productService) {
                    throw new Error('productService 不可用');
                }
                
                // 测试获取HOTPRODUCTS数据
                const products = await productService.fetchProducts('HOTPRODUCTS');
                
                let html = '<div class="test-result">✅ API调用成功</div>';
                html += `<div class="test-result">获取到 ${products.length} 个产品</div>`;
                
                if (products.length > 0) {
                    const firstProduct = products[0];
                    html += `<div class="test-result">示例产品: ${firstProduct.spbt || '无标题'}</div>`;
                }
                
                apiCallDiv.innerHTML = html;
                
            } catch (error) {
                apiCallDiv.innerHTML = `<div class="test-result error">❌ API调用失败: ${error.message}</div>`;
            }
        }
        
        // 页面加载时自动运行基础测试
        document.addEventListener('DOMContentLoaded', function() {
            testConfigLoading();
        });
    </script>
    
    <!-- 引入Font Awesome用于图标显示 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</body>
</html>